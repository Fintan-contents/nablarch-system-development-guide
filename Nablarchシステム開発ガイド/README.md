# Nablarchシステム開発ガイド

## 目次

- [はじめに](#はじめに)
  - [このドキュメントの対象読者](#このドキュメントの対象読者)
  - [読み方の注意点](#読み方の注意点)
- [全体像](#全体像)
- [プロジェクト計画](#プロジェクト計画)
- [要件定義工程](#要件定義工程)
  - [要件定義](#要件定義)
  - [方式設計](#方式設計)
  - [プロジェクト成果物の確認](#プロジェクト成果物の確認)
  - [テスト計画](#テスト計画)
  - [プロジェクト用の開発ガイド作成](#プロジェクト用の開発ガイド作成)
- [設計工程](#設計工程)
  - [標準化](#標準化)
- [PGUT工程](#PGUT工程)
  - [Nablarchプロジェクト初期構築](#Nablarchプロジェクト初期構築)
  - [チーム開発環境構築](#チーム開発環境構築)
  - [開発環境構築ガイドの作成](#開発環境構築ガイドの作成)
  - [開発標準の整備](#開発標準の整備)
- [結合テスト工程](#結合テスト工程)
  - [結合テスト準備（疎通確認）](#結合テスト準備疎通確認)
- [システムテスト工程](#システムテスト工程)
- [保守運用](#保守運用)


## はじめに

このドキュメントは、Nablarchを使ってシステム開発を行うエンジニアに対して、開発開始前・開発中になにをすべきか、なにを参照すれば良いかを示すものです。Nablarchを使ったシステム開発に必要と考えているアクティビティについて、多くのプロジェクトで最適と思われる進め方を記載しています。

多くのNablarch利用プロジェクトの特性を踏まえて、開発プロセスはウォーターフォール開発を想定しています。


プロジェクト本格開始前にこのドキュメントを一通り確認して、開発をどのように進めるか検討してください。


### このドキュメントの対象読者

Nablarchを使ったシステム開発を始めようとしているエンジニア（特にITアーキテクト、プロジェクトマネージャー）を対象としています。

### 読み方の注意点

このドキュメントには多くのリンクが存在します。最初に読み進める段階でリンクを追っていくと、リンク先のドキュメントも多いため、
全体像をつかみにくくなります。最初はあまりリンク先に飛ばず「こんなリンクがあるんだな」くらいの認識で、このドキュメントを最後まで読むようにしてください。


## 全体像

プロジェクト開発で必要となる成果物やタスクは多岐にわたります。
以下に挙げるのは、中規模のシステム開発を想定したサンプルプロジェクトにおける開発の流れを示した図です。
プロジェクトの開発の流れを検討する際の参考にしてください（最初は図の要素全てを理解する必要はありません。工程毎に成果物やタスクがあることを掴めれば十分です）。

- [Nablarchを使用した開発の流れ](../サンプルプロジェクト/設計書/Nablarchを使用した開発の流れ.xlsx?raw=true)


## プロジェクト計画

ウォーターフォール開発に必要な作業を漏らさないことを目的として役割分担を決めるシートです。担当間の認識の相違をなくし、リスクの早期発見、問題拡大の未然防止を図ります。

- [ウォーターフォール開発における役割分担シート](https://fintan.jp/?p=1326)



## 要件定義工程


### 要件定義

業務/システム要件定義の進め方、成果物、活用技法、ノウハウを体系的かつ実践的なレベルにまとめたガイドラインです。
- [要件定義フレームワーク](https://fintan.jp/?p=233)


実践的な要件定義知識やテクニックを解説した資料です。
- [要件定義基礎研修テキスト](https://fintan.jp/?p=1389)



#### 非機能要件

性能要件やセキュリティ要件などの非機能要件が固まっていない状態で方式設計を行っても、方式設計は完成しません。

非機能要件定義には、IPAから提供されている非機能要求グレードを参考にしてください。

- [非機能要求グレード](https://www.ipa.go.jp/sec/softwareengineering/std/ent03-b.html)


### 方式設計

方式設計は、以下のサンプルをベースに行います。

- [アプリケーション方式設計書サンプル](https://fintan.jp/?p=1323)

ただし、プロジェクトの非機能要件を方式設計に落とし込んでいく必要があるため、このサンプルを修正して方式設計完了としてはいけません。サンプルをコピー、修正して方式設計書を完成させるというやり方をすると、必要な非機能要件を漏らす、不要な方式設計を記載してしまう、というミスが発生します。

サンプルをコピーするのではなく、サンプルから流用できる箇所、参考にできる箇所を抽出し、プロジェクトの方式設計書へ持ってきて完成させるようにしましょう。プロジェクトの非機能要件を元に方式設計の見出しを作成し、サンプルを参考にできる箇所は参考にし、プロジェクト固有の要件で検討が必要な箇所は検討結果を記載し、プロジェクトの方式設計書を完成させます。

特に、性能やセキュリティについては上記サンプルではカバーしていないので、特に注意が必要です。
方式設計サンプルの記述に追記するか、別冊として「方式設計書（セキュリティ設計）」のように別途作成するなどします。

セキュリティ設計については、IPAの「安全なウェブサイトの作り方」を参照してください。
「セキュリティ実装 チェックリスト」の全て項目が「根本的解決」となるように設計を行います。重複はありますが、「OWASP Top10」もチェックしておきます。

- [安全なウェブサイトの作り方](https://www.ipa.go.jp/security/vuln/websecurity.html)
- [OWASP Top10](https://github.com/OWASP/Top10)

#### Nablarchパターン集

Nablarchでよく使われるパターン、および、やってはいけない（がやってしまいがちな）アンチパターンを紹介します。
使い方を誤って設計、プログラミングをすると、大きな手戻りや性能不良、最悪の場合は本番障害となる恐れがあります。
設計開始前に本項を一読しておくことをお勧めします。

- [Nablarchパターン集](./docs/nablarch-patterns/README.md)


### プロジェクト成果物の確認

Nablarchをプロジェクトで使用した経験がない場合は、ここでサンプルプロジェクトを参照し、
実際のプロジェクト成果物を確認しておきましょう。
特に以下の点に着目して参照すると効率が良いです。

- プロジェクト用に作成した開発ガイド
- プロジェクト用にカスタマイズした単体テスト仕様書
- 設計書とソースコードとの対応関係

これらを確認することで、今後の作業のイメージが湧きやすくなります。

- [サンプルプロジェクト](../サンプルアプリケーション)


#### サンプルプロジェクトに関する注意事項

サンプルプロジェクトの成果物を、何の検討もせずにコピーして流用するのはやめましょう。

サンプルプロジェクトの成果物は、サンプルプロジェクトの要件と特性を踏まえて、
Nablarchの設計標準をカスタマイズしたり、自作して作成したものです。

プロジェクトの要件や特性が同じということは無いので、
何も考えずにコピーして流用すると、必ず自身のプロジェクトと合わない箇所が出てきます。
この場合、以下のような問題が発生します。
- プロジェクトに不要なルールが含まれており生産性を落としてしまう
- プロジェクトに必要なテスト観点が漏れており十分な品質が確保できない
- 不明な記述があるが誰も理由や経緯を答えられない。

必ず、自身のプロジェクトの要件と特性を踏まえた上で、標準化やガイドを新規で作成するようにしてください。
その際、サンプルプロジェクトは、コピー元としてではなく、参考用途に使用してください。


### テスト計画


アプリケーション開発プロジェクトの、全体テスト計画で検討すべきトピックを解説したコンテンツです。
- [全体テスト計画ガイド](https://fintan.jp/?p=251)


アプリケーション開発で使用可能なテストの種別と観点を整理したカタログです。
- [テスト種別＆観点カタログ](https://fintan.jp/?p=45)


### プロジェクト用の開発ガイド作成

開発者がプロジェクトを進めるために必要な情報を集約したガイドを作成します。

作成例はサンプルプロジェクトの以下をご覧ください。
- [サンプルプロジェクト開発ガイド](../サンプルアプリケーション/サンプルアプリケーション開発ガイド)


## 設計工程

### 標準化

各工程の開始に間に合うよう、標準化作業を進めます。
以下の標準をベースにして、プロジェクト用にカスタマイズします。

- [Nablarch アプリケーション設計標準](https://fintan.jp/?p=1145)

特にアプリケーション開発標準(*1)を参照してください。

ここにはDB設計標準やUI標準等、重要な設計標準ドキュメントが含まれています。

特にUI標準については、設計工程が本格化する前に展開しておく必要があります。
標準が無い状態で設計を進めてしまうと、画面レイアウト等のUIが設計者やカウンターのお客様ごとにバラけてしまいます。
（例：ボタンの配置位置、確認画面や完了画面の有無、必要以上にリッチなUI機能）
これらは、後で統一するためにお客様承認が必要となったり、横並び修正が発生することになります。
一度提示してしまったUIを撤回できないこともあり、この場合、PGUT工程で個別の作り込みが必要となり工数オーバーするといったリスクがあります。  
参考：[UI標準のカスタマイズ](docs/UI標準のカスタマイズ.md)

カスタマイズ例はサンプルプロジェクトの以下をご覧ください。
- [設計標準](../サンプルプロジェクト/設計書/020_方式設計/020_開発標準/010_設計標準)
- [テスト標準](../サンプルプロジェクト/設計書/020_方式設計/020_開発標準/020_テスト標準)

アプリケーションのパッケージ構成については[「パッケージ構成検討」](docs/パッケージ構成検討.md)を参照してください。


*1: [アプリケーション開発標準](https://github.com/nablarch-development-standards/nablarch-development-standards/tree/master/020_アプリケーション開発標準)



#### 単体テスト標準

どのようなテストを実施するかは、プロジェクトの特性によって大きく変わります。
テスト標準作成の際には、以下の項目を参照してください。

- [テスト項目の検討](docs/テスト項目の検討.md)



## PGUT工程


### Nablarchプロジェクト初期構築

Nablarchを使ったプロジェクトの初期構築を行います。
こちらを参照してください。

- [Nablarchプロジェクト初期構築](./docs/Nablarchプロジェクト初期構築.md)

### チーム開発環境構築

Gitリポジトリやチャット等、チームで開発を行うための環境構築を行います。

- [チーム開発環境構築](./docs/チーム開発環境構築.md)

### 開発環境構築ガイドの作成

アプリケーション開発者向けの環境構築ガイドを整備します。
こちらを参照してください。

- [開発環境構築ガイドの作成](./docs/開発環境構築ガイドの作成.md)


### 開発標準の整備

PGUT工程の開発標準を整備します。
以下のドキュメントを参考にしてください。

品質、生産性、保守性の向上を目的とした、プログラマーが遵守するべきコーティング規約です。
- [Nablarch コーディング規約](https://fintan.jp/?p=1145)


PG・UT作業の完了条件を開発者が確認するためのチェックリストです。
- [PG・UT作業の完了条件チェックリスト](https://fintan.jp/?p=1367)


コーディング規約違反などの単純なコーディングミスをしていないかを開発者自身が確認するためのチェックリストです。
- [プログラマー向け成果物セルフチェックリスト](https://fintan.jp/?p=1369)



## 結合テスト工程

### 結合テスト準備（疎通確認）

結合テスト開始前(PGUT工程)に、結合テスト環境向けの設定変更および疎通確認を行います。

PGUT工程でのローカル開発環境から結合テスト環境に移行する際、多くの差異が発生します。
（例:ファイルパスの違い、モックの使用有無）
このため、余裕を持って結合テスト環境用の設定を行う必要があります。
結合テストまでに十分な疎通確認ができていない場合、
テスト開始直後に基盤部分でエラーが頻発し、テスト全体の進捗を遅らせる要因となります。

まず、方式設計書からケースを抽出します。
例えば「認証」に関する記述があれば、認証機能が動作することを確認するケースを上げます。
次に、環境ごとに、前工程での環境差異があるかどうかをチェックします。

以下に例を示します。

| 観点           | UT->IT | IT->ST | ST->本番 | 説明                                           |
|----------------|--------|--------|----------|------------------------------------------------|
| 認証           | 有     | 無     | 有       | IT工程からシステム全体の共通テストデータを使用 |
| 帳票出力       | 無     | 有     | 無       | ライセンスの都合上、帳票出力はSTから実施       |
| ファイル入出力 | 有     | 無     | 無       | OS差異により、パス指定方法が異なる             |
| ファイル転送   | 有     | 有     | 有       | 環境毎にIPアドレスの変更が必要                 |
| バッチ         | 有     | 無     | 有       | IT工程からシェルスクリプトを使用               |
| 　 　：        |        |        |          |                                                |

差異が発生する部分は、その環境に応じた設定変更等を行います。

差異が発生する箇所を中心に疎通確認を行います。
特に、テスト全体への影響が大きい機能(動作しないとテストができないような機能)を優先的にテストします。


## システムテスト工程

(プロジェクトからのフィードバックを受けて拡充させていく予定です)

## 保守運用

(プロジェクトからのフィードバックを受けて拡充させていく予定です)

