# 取引単体テストの自動実行方法（Web）

ここでは、 [取引単体テストのテスト方法（Web）](取引単体テストのテスト方法（Web）.md) で説明した取引単体テストを、JUnitを利用して自動実行するツールについて説明します。

## ツールの場所
自動実行のためのツールは、顧客管理システムの中の次の場所に用意されています。

[proman-jmeter](../../../ソースコード/proman-project/proman-jmeter)

## サンプルシナリオを実行する
`proman-jmeter` には、次の２つの取引単体テストのサンプルシナリオが用意されています。

1. プロジェクトを登録する
1. プロジェクトを更新する

ここでは、２つのサンプルシナリオを実際に動かす方法について説明します。

### 顧客管理システムを起動する
顧客管理システムの起動方法については、顧客管理システムの [README](../../../ソースコード/proman-project/proman-web/README.md) を参照してください。

### ツールを実行する
ツールを実行する前に、ローカルの JMeter のインストールディレクトリをツールに設定する必要があります。

[proman-jmeter/src/test/resources/env.properties](../../../ソースコード/proman-project/proman-jmeter/src/test/resources/env.properties) をテキストエディタで開き、 `jmeter.home` の値にローカルのJMeterのインストールディレクトリを設定してください。

```properties
（省略）
jmeter.home=【ここにJMeterのインストールディレクトリを設定する】
（省略）
```

JMeterの設定が完了したら、コマンドラインで `proman-jmeter` のディレクトリまで移動して以下のコマンドを実行してください。

```
$cd proman-jmeter
$mvn clean test
```

テストが成功すると、コマンドラインに次のように表示されます。

```
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
```

## 仕組みや詳細な使い方
ツールの仕組みや詳細な使い方については、ツールの [README](../../../ソースコード/proman-project/proman-jmeter/README.md) を参照してください。

## サンプルプロジェクト以外で使用する
この自動化ツールは、顧客管理システムに依存していません。
したがって、 `proman-jmeter` のみを切り出して別のプロジェクトで使用できます。

サンプルプロジェクト以外のシステムで本ツールを使用したい場合は、 `proman-jmeter` のディレクトリだけをコピーして利用してください。

## CIに組み込む場合の注意点
この自動化ツールは、CIに取引単体テストを組み込むために用意しています。

しかし、JMeterを利用した本方式は実行時間が長くなる傾向があります。

このため、定期的に何度も実行するようなCIに本ツールを使ったテストを組み込んだ場合、CIの実行時間が非常に長くなる恐れがあります。

したがって、CIに本テストを組み込む場合は実行時間に留意してください。  
もし実行時間が許容できない長さになる場合は、繰り返しのCIの中には組み込まず、単独のタスクとして切り出して必要に応じて手動実行するような形式を検討してください。
