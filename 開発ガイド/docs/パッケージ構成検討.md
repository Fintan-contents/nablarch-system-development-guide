# パッケージ構成検討

## パッケージ構成の考え方

パッケージ構成については「必ずこうすればよい」というやり方があるわけでありませんが、基本となる考え方はあります。
プロジェクトの特性に合わせてパッケージ構成を考えます。

システムのURLに制約がある場合は、まずURL設計を行い、そのURLを実現できるパッケージ構成を決めるのがよいです。
Nablarchでルーティングの設定をする場合、パッケージ構成によってはURLに制約が出てしまうケースがあるからです。

イントラシステム等で、特にURLに制約がない場合は、プロジェクトの体制を考慮してパッケージ構成を決めるのが望ましいです。


パッケージ構成を考えるうえで、大きく以下の2つ（ないし、その組み合わせ）のやり方があります。

- 業務的な機能で分割
- クラスの役割で分割


例として「会員管理システム」に以下のような業務機能を持つとします。

| 業務名   | パッケージ名 |
|----------|--------------|
| 入会     | nyukai       |
| 属性変更 | henkou       |
| ポイント | point        |

## 業務的な機能での分割例

業務的な機能で分割した場合、以下のようになります。

- com.example.member
  - nyukai
    - XXXAction
    - XXXForm
    - XXXDto
    - YYYAction
    - YYYForm
    - YYYDto
    - ZZZService
  - henkou
    - （略）
  - point
    - （略）



プロジェクトで開発を行う場合、業務的な機能のまとまりで分担を行うことがよくあります。
例えば、以下のような分担を行います。

- xxxサブシステムはA社担当
- yyy機能はBさん担当

この場合、パッケージ配下がその担当者の成果物だけが格納されるので、分業、並行開発がやりやすくなります。
例えば、パッケージ配下に使用されないクラスがあったとした場合、そのパッケージの担当者が責任を負います。
1つのパッケージを複数の担当者が共有する場合は、成果物の責任の所在が曖昧になることがあります。

ただし、パッケージの粒度が大きすぎる場合、1つのパッケージに格納されるクラスが多くなりすぎて開発がやりにくくなります。
このような場合は、パッケージを複数階層に細かく分けることで、1パッケージ内のクラス数を抑えることができます。
例えば「入会」業務の機能が膨らんできた場合は、`入会/審査`や`入会/キャンペーン`のように階層を作ります。


## クラスの役割での分割例

クラスの役割で分割すると以下のようになります。

- com.example.member
  - action
    - XXXAction
    - YYYAction
    -  （略）
  - form
    - XXXForm
    - YYYForm
    -  （略）
  - dto
    - XXXDto
    - YYYDto
    -  （略）
  - service
    - ZZZService
    -  （略）

この構成の場合、いわゆるレイヤードアーキテクチャが実現しやすくなります。
あまり一般的ではないですが、業務的な機能ではなくレイヤーで担当を割ることがあります。
（プレゼンテーション担当とドメイン担当のように）
このような場合は、クラスの役割でパッケージを分割するほうが分業がやりやすくなります。

システム規模が大きくなりすぎると、パッケージ内のクラスが多くなりすぎで開発がやりにくくなります。
このパッケージ構成のままではこの問題は解決できないので、大規模プロジェクトはこの構成は避けたほうが無難です。


### クラスの役割 - 業務的な機能 での分割例

上記2つを組み合わせることも可能です。


- com.example.member
  - action
    - nyukai
      - XXXAction
      - YYYAction
    - henkou
      - （略）
    - point
      - （略）
  - form
    - nyukai
      - XXXForm
      - YYYForm
    - henkou
      - （略）
    - point
      - （略）
  - dto
      - XXXDto
      - YYYDto
    - henkou
      - （略）
    - point
      - （略）
  - service
    - nyukai
      - ZZZService
    - henkou
      - （略）
    - point
      - （略）

`com.example.member.action`をルートパッケージに指定できるので、routes.xmlでの記載もやりやすいです。
    

### 業務的な機能 - クラスの役割 での分割例

一見良いように見えますが、actionパッケージが複数できてしまうため、Nablarchのroutes.xmlで扱いにくくなります。
無理に扱おうとするとURLが長くなるというデメリットがあります。

- com.example.member
  - nyukai
    - action
      - XXXAction
      - YYYAction
    - form
      - XXXForm
      - YYYForm
    - dto
      - XXXDto
      - YYYDto
    - service
      - ZZZService
  - henkou
    - action
    - （略）
  - point
    - （略）


